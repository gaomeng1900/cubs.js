import{C as K,d as m,a as R}from"./Test.module-4ee382fa.js";function S(e,f,b,g=10,w={},E={},O={},L){const _=Object.freeze({type:"polylineEdit",target:e,currentTarget:e}),o=()=>{const s={type:"beforePolylineEdit",target:e,currentTarget:e};f==null||f(s),b==null||b(_)},a=new R,v=new WeakMap;e.points.map(s=>{const t=new K(s.x,s.y,g);t.fixedRadius=!0,t.radius=g,Object.assign(t.style,w),Object.assign(t.hoverStyle,E),Object.assign(t.activeStyle,O),v.set(s,t),m(t,r=>{s.x=r.x,s.y=r.y},o),a.add(t),t.addEventListener("pointerdown",r=>{if(r.srcEvent.ctrlKey||r.srcEvent.metaKey){const i=e.points.indexOf(s);e.points.splice(i,1),a.remove(t),v.delete(s),o()}})});const h=s=>{if(s.srcEvent.ctrlKey||s.srcEvent.metaKey){const t=s.hitResult;if(!t)return;const r=t.t,i=t.index,u=e.points[i-1],d=e.points[i]||e.points[0],c={x:u.x+((d==null?void 0:d.x)-u.x)*r,y:u.y+((d==null?void 0:d.y)-u.y)*r};e.points.splice(i,0,c);const n=new K(c.x,c.y,g);n.fixedRadius=!0,n.radius=g,Object.assign(n.style,w),Object.assign(n.hoverStyle,E),Object.assign(n.activeStyle,O),v.set(c,n),m(n,x=>{c.x=x.x,c.y=x.y},o),a.add(n),n.addEventListener("pointerdown",x=>{if(x.srcEvent.ctrlKey||x.srcEvent.metaKey){const y=e.points.indexOf(c);e.points.splice(y,1),a.remove(n),v.delete(c),o()}})}};e.addEventListener("pointerdown",h);const D=L?()=>{}:m(e,void 0,o),P=s=>{e.points.forEach(t=>{const r=v.get(t);r.x=t.x,r.y=t.y})};e.addEventListener("beforeRender",P),e.add(a),e.userData.__controllers=a;const j=()=>{D(),e.removeEventListener("pointerdown",h),e.removeEventListener("beforeRender",P),e.remove(a),e.userData.__controllers=[]};return e.userData.__cancelEdit=j,j}export{S as e};
