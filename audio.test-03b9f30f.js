import{r as g,j as u}from"./index-767ff75a.js";import{C as A,c as D,a as L,t as M,b as P,l as O}from"./coordinate-a91a122f.js";import{X as W,d as X}from"./marker-14fb4d82.js";import{S as U,s as q}from"./Test.module-0a03da6d.js";async function z(s){const n=await fetch(s).then(e=>e.blob()),t=new Audio;t.src=URL.createObjectURL(n),t.crossOrigin="anonymous",t.preload="auto";const c=await new Promise(e=>{t.addEventListener("loadedmetadata",()=>{e(t.duration)})});return t.load(),await new Promise((e,o)=>{t.addEventListener("canplaythrough",()=>{e()}),t.addEventListener("error",()=>{o()})}),{audio:t,blob:n,duration:c}}async function B(s,n){const t=new AudioContext({sampleRate:n});return t.decodeAudioData(s).finally(()=>t.close())}const H="./test-audio.mp3",J="https://freesound.org/people/quetzalcontla/sounds/612846/";function G(){const s=g.useRef(null),n=800,t=600;return g.useEffect(()=>{const c=s.current,e=new U(c),o=new A;o.viewportWidth=n-200,o.viewportHeight=t-200,D(e,o,{lockY:!0,lockScale:!1,xStartMin:0,xEndMax:100});const v=new L(o,{followOrigin:!1});e.add(o.indicator);const E=M(o);e.add(E);const C=new W(o,{draggable:!0,min:0,max:100});return e.add(C),X(e,o,{draggable:!0}),e.add(v),(async()=>{const{blob:R}=await z(H),S=await R.arrayBuffer(),r=(await B(S,3e3)).getChannelData(0),w=r.length,j=r.reduce((a,l)=>Math.max(Math.abs(l),a),0),d=100,i=100;let h=1*.5*i;h=1/j*.5*i;const x=4e3,f=[];if(x<r.length)for(let a=0;a<x;a++){const l=a/x,k=Math.floor(l*w);f.push({x:l*d,y:r[k]*h+.5*i})}else for(let a=0;a<r.length;a++)f.push({x:a/w*d,y:r[a]*h+.5*i});const b=P(o,[{x:d/2,y:i}],{barWidth:d}),p=Array.from(b.children.values())[0];p.style.pointerEvents="none",p.style.stroke=!0,p.style.strokeStyle="black",e.add(b);const m=O(o,f),y=m.userData.polyline;y.style.lineWidth=1,y.style.lineJoin="miter",y.style.pointerEvents="none",e.add(m)})(),()=>{e.dispose()}},[]),u.jsxs("div",{className:q.wrapper,children:[u.jsx("canvas",{ref:s,width:n,height:t,style:{width:n,height:t,border:"rgb(255, 255, 255) 3px solid",boxShadow:"#00000076 0 0 10px 1px"}}),u.jsx("div",{children:u.jsx("a",{href:J,target:"_blank",rel:"noreferrer",children:"测试音频来源"})})]})}export{G as default};
