import{C as h,d as u,g as R}from"./Test.module-87944f70.js";function D(e,b,m,g=10,E={},w={},y={}){const j=Object.freeze({type:"polylineEdit",target:e,currentTarget:e}),o=()=>{const s={type:"beforePolylineEdit",target:e,currentTarget:e};b==null||b(s),m==null||m(j)},a=new R,v=new WeakMap;e.points.map(s=>{const t=new h(s.x,s.y,g);t.fixedRadius=!0,t.radius=g,Object.assign(t.styles,E),Object.assign(t.hoverStyles,w),Object.assign(t.activeStyles,y),v.set(s,t),u(t,r=>{s.x=r.x,s.y=r.y},o),a.add(t),t.addEventListener("pointerdown",r=>{if(r.srcEvent.ctrlKey||r.srcEvent.metaKey){const x=e.points.indexOf(s);e.points.splice(x,1),a.remove(t),v.delete(s),o()}})});const O=s=>{if(s.srcEvent.ctrlKey||s.srcEvent.metaKey){const t=s.hitResult;if(!t)return;s.srcEvent.preventDefault(),s.srcEvent.stopPropagation();const r=t.t,x=t.index,f=e.points[x-1]||{x:0,y:0},d=e.points[x]||{x:0,y:0},c={x:f.x+((d==null?void 0:d.x)-f.x)*r,y:f.y+((d==null?void 0:d.y)-f.y)*r};e.points.splice(x,0,c);const n=new h(c.x,c.y,g);n.fixedRadius=!0,n.radius=g,Object.assign(n.styles,E),Object.assign(n.hoverStyles,w),Object.assign(n.activeStyles,y),v.set(c,n),u(n,i=>{c.x=i.x-e.x,c.y=i.y-e.y},o),a.add(n),n.addEventListener("pointerdown",i=>{if(i.srcEvent.ctrlKey||i.srcEvent.metaKey){const L=e.points.indexOf(c);e.points.splice(L,1),a.remove(n),v.delete(c),o()}})}};e.addEventListener("pointerdown",O);const K=u(e,void 0,o),P=s=>{e.points.forEach(t=>{const r=v.get(t);r.x=t.x,r.y=t.y})};return e.addEventListener("beforeRender",P),e.add(a),()=>{K(),e.removeEventListener("pointerdown",O),e.removeEventListener("beforeRender",P),e.remove(a)}}export{D as e};
