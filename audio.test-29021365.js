import{_ as m,j as u}from"./index-aea94668.js";import{C as k,c as A,a as _,t as L,X as M,d as P,b as O,l as W}from"./coordinate-44e6cf7c.js";import{S as X,s as U}from"./Test.module-4ee382fa.js";async function q(s){const n=await fetch(s).then(t=>t.blob()),e=new Audio;e.src=URL.createObjectURL(n),e.crossOrigin="anonymous",e.preload="auto";const i=await new Promise(t=>{e.addEventListener("loadedmetadata",()=>{t(e.duration)})});return e.load(),await new Promise((t,o)=>{e.addEventListener("canplaythrough",()=>{t()}),e.addEventListener("error",()=>{o()})}),{audio:e,blob:n,duration:i}}async function z(s,n){const e=new AudioContext({sampleRate:n});return e.decodeAudioData(s).finally(()=>e.close())}const B="./test-audio.mp3",H="https://freesound.org/people/quetzalcontla/sounds/612846/";function F(){const s=m.useRef(null),n=800,e=600;return m.useEffect(()=>{const i=s.current,t=new X(i),o=new k;o.viewportWidth=n-200,o.viewportHeight=e-200,A(t,o,{lockY:!0,lockScale:!1,xStartMin:0,xEndMax:100});const v=new _(o,{followOrigin:!1});t.add(o.indicator);const E=L(o);t.add(E);const R=new M(o,{draggable:!0,min:0,max:100});return t.add(R),P(t,o,{draggable:!0}),t.add(v),(async()=>{const{blob:C}=await q(B),D=await C.arrayBuffer(),r=(await z(D,3e3)).getChannelData(0),w=r.length,S=r.reduce((a,l)=>Math.max(Math.abs(l),a),0),d=100,c=100;let h=1*.5*c;h=1/S*.5*c;const x=4e3,f=[];if(x<r.length){console.log("xResolution > channelData.length，重新采样");for(let a=0;a<x;a++){const l=a/x,j=Math.floor(l*w);f.push({x:l*d,y:r[j]*h+.5*c})}}else for(let a=0;a<r.length;a++)f.push({x:a/w*d,y:r[a]*h+.5*c});const b=O(o,[{x:d/2,y:c}],{barWidth:d}),p=Array.from(b.children.values())[0];p.style.pointerEvents="none",p.style.stroke=!0,p.style.strokeStyle="black",t.add(b);const g=W(o,f),y=g.userData.polyline;y.style.lineWidth=1,y.style.lineJoin="miter",y.style.pointerEvents="none",t.add(g)})(),()=>{t.dispose()}},[]),u.jsxs("div",{className:U.wrapper,children:[u.jsx("canvas",{ref:s,width:n,height:e,style:{width:n,height:e,border:"rgb(255, 255, 255) 3px solid",boxShadow:"#00000076 0 0 10px 1px"}}),u.jsx("div",{children:u.jsx("a",{href:H,target:"_blank",rel:"noreferrer",children:"测试音频来源"})})]})}export{F as default};
