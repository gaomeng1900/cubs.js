import{C as K,e as m,h as R}from"./Test.module-f3780946.js";function S(e,f,b,g=10,w={},E={},h={},L){const _=Object.freeze({type:"polylineEdit",target:e,currentTarget:e}),d=()=>{const s={type:"beforePolylineEdit",target:e,currentTarget:e};f==null||f(s),b==null||b(_)},a=new R,v=new WeakMap;e.points.map(s=>{const t=new K(s.x,s.y,g);t.fixedRadius=!0,t.radius=g,Object.assign(t.styles,w),Object.assign(t.hoverStyles,E),Object.assign(t.activeStyles,h),v.set(s,t),m(t,r=>{s.x=r.x,s.y=r.y},d),a.add(t),t.addEventListener("pointerdown",r=>{if(r.srcEvent.ctrlKey||r.srcEvent.metaKey){const i=e.points.indexOf(s);e.points.splice(i,1),a.remove(t),v.delete(s),d()}})});const O=s=>{if(s.srcEvent.ctrlKey||s.srcEvent.metaKey){const t=s.hitResult;if(!t)return;const r=t.t,i=t.index,u=e.points[i-1],o=e.points[i]||e.points[0],c={x:u.x+((o==null?void 0:o.x)-u.x)*r,y:u.y+((o==null?void 0:o.y)-u.y)*r};e.points.splice(i,0,c);const n=new K(c.x,c.y,g);n.fixedRadius=!0,n.radius=g,Object.assign(n.styles,w),Object.assign(n.hoverStyles,E),Object.assign(n.activeStyles,h),v.set(c,n),m(n,x=>{c.x=x.x,c.y=x.y},d),a.add(n),n.addEventListener("pointerdown",x=>{if(x.srcEvent.ctrlKey||x.srcEvent.metaKey){const y=e.points.indexOf(c);e.points.splice(y,1),a.remove(n),v.delete(c),d()}})}};e.addEventListener("pointerdown",O);const D=L?()=>{}:m(e,void 0,d),P=s=>{e.points.forEach(t=>{const r=v.get(t);r.x=t.x,r.y=t.y})};e.addEventListener("beforeRender",P),e.add(a),e.userData.__controllers=a;const j=()=>{D(),e.removeEventListener("pointerdown",O),e.removeEventListener("beforeRender",P),e.remove(a),e.userData.__controllers=[]};return e.userData.__cancelEdit=j,j}export{S as e};
