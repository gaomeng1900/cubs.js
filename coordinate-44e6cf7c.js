var A=Object.defineProperty;var T=(s,e,t)=>e in s?A(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var f=(s,e,t)=>(T(s,typeof e!="symbol"?e+"":e,t),t);import{r as g,p as B,P as z,R as j,a as m,b as M,d as L,E as G,c as V,T as C}from"./Test.module-4ee382fa.js";function U(s,e,t){const{color:l,size:y=10}=t||{},p=new m;return e.map(h=>{const i=h.color??l??g(),r=h.size??y,n=B();n.style.fillStyle=i,n.radius=r,n.addEventListener("beforeRender",x=>{const a=s.project(h.x,h.y);n.x=a[0],n.y=a[1]}),p.add(n)}),p}function q(s,e,t){const{color:l=g(),lineWidth:y=2}=t||{},p=new m,h=e.slice().sort((r,n)=>r.x-n.x),i=new z;return i.style.strokeStyle=l,i.style.lineWidth=y,h.map(r=>{const n=s.project(r.x,r.y);i.points.push({x:n[0],y:n[1]})}),p.addEventListener("beforeRender",r=>{i.points=[],h.map(n=>{const x=s.project(n.x,n.y);i.points.push({x:x[0],y:x[1]})})}),p.add(i),p.userData.polyline=i,p}function J(s,e,t){const{color:l=g(.5),barWidth:y=1}=t||{},p=new m,h=e.slice().sort((r,n)=>r.x-n.x),i=new WeakMap;return h.map(r=>{const n=new j;n.style.fillStyle=r.color??l,p.add(n),i.set(r,n)}),p.addEventListener("beforeRender",r=>{h.map(n=>{const x=i.get(n);if(!x)throw new Error("bar data not found");const[a,c]=s.project(n.x-y/2,0),[d,o]=s.project(n.x+y/2,n.y);x.x=a,x.y=o,x.width=d-a,x.height=c-o})}),p}class D extends j{constructor(t,l){super();f(this,"xStart",0);f(this,"xEnd",50);this.coordinator=t,this.config=l;const y=Math.random(),{color:p=g(.2,y)}=l||{},{min:h=-1/0,max:i=1/0}=l||{};this.style.fillStyle=p;const r=new M;r.style.zIndex=5,r.style.lineWidth=5,r.style.strokeStyle=g(.9,y),r.hoverStyle.strokeStyle=g(1,y+.5),this.add(r);const n=new M;n.style.zIndex=5,n.style.lineWidth=5,n.style.strokeStyle=g(.9,y),n.hoverStyle.strokeStyle=g(1,y+.5),this.add(n),this.addEventListener("beforeRender",x=>{this.y=t.top,this.height=t.viewportHeight,this.x=t.project(this.xStart,0)[0],this.width=t.project(this.xEnd,0)[0]-this.x,r.x=0-(r.style.lineWidth||1)/2,r.y=0,r.dx=0,r.dy=t.viewportHeight,n.x=this.width+(r.style.lineWidth||1)/2,n.y=0,n.dx=0,n.dy=t.viewportHeight}),l!=null&&l.draggable&&(L(this,x=>{if(this.xStart=t.unproject(x.x,0)[0],this.xEnd=t.unproject(x.x+this.width,0)[0],this.xStart<h){const a=this.xEnd-this.xStart;this.xStart=h,this.xEnd=h+a,x.x=t.project(h,0)[0]}if(this.xEnd>i){const a=this.xEnd-this.xStart;this.xEnd=i,this.xStart=i-a,x.x=t.project(i,0)[0]}}),L(r,x=>{this.x=t.project(this.xStart,0)[0],this.x+=x.dx,this.width-=x.dx,this.width<0&&(this.width=0),this.xStart=t.unproject(this.x,0)[0],this.xEnd=t.unproject(this.x+this.width,0)[0]},()=>{this.xStart=Math.min(Math.max(this.xStart,h),i),this.xEnd=Math.min(Math.max(this.xEnd,h),i),this.x=t.project(this.xStart,0)[0],this.width=t.project(this.xEnd,0)[0]-this.x}),L(n,x=>{this.width+=x.dx,this.width<0&&(this.width=0),this.xEnd=t.unproject(this.x+this.width,0)[0]},()=>{this.xStart=Math.min(Math.max(this.xStart,h),i),this.xEnd=Math.min(Math.max(this.xEnd,h),i),this.x=t.project(this.xStart,0)[0],this.width=t.project(this.xEnd,0)[0]-this.x}))}}function K(s,e,t){let l;const y=p=>{const h=p.srcEvent;if(console.log(p.target,p.currentTarget),h.button!==0||p.target!==p.currentTarget)return;h.preventDefault();const{left:i,top:r}=s.canvas.getBoundingClientRect()||{left:0,top:0},n=h.clientX-i,x=h.clientY-r;if(e.viewportX>n||e.viewportX+e.viewportWidth<n||e.viewportY>x||e.viewportY+e.viewportHeight<x)return;l=new D(e),s.add(l),l.xStart=e.unproject(n,0)[0],l.xEnd=e.unproject(n,0)[0];const a=d=>{const u=d.srcEvent.clientX-i;l.xEnd=e.unproject(u,0)[0],e.dispatchEvent({type:"update"})},c=d=>{s.removeEventListener("pointermove",a),s.removeEventListener("pointerup",c),s.remove(l);const o=new D(e,t);o.xStart=l.xStart,o.xEnd=l.xEnd,s.add(o)};s.addEventListener("pointermove",a),s.addEventListener("pointerup",c)};return s.addEventListener("pointerdown",y),()=>{s.removeEventListener("pointerdown",y),l&&s.children.has(l)&&s.remove(l)}}class N extends G{constructor(){super();f(this,"xStart",0);f(this,"xEnd",100);f(this,"yStart",0);f(this,"yEnd",100);f(this,"viewportX",100);f(this,"viewportY",100);f(this,"viewportWidth",400);f(this,"viewportHeight",200);f(this,"indicator",new j);this.indicator.style.stroke=!0,this.indicator.style.fill=!1,this.indicator.style.pointerEvents="none",this.indicator.style.strokeStyle=g(.5),this.indicator.addEventListener("beforeRender",t=>{this.indicator.x=this.viewportX,this.indicator.y=this.viewportY,this.indicator.width=this.viewportWidth,this.indicator.height=this.viewportHeight})}get top(){return this.viewportY}get bottom(){return this.viewportY+this.viewportHeight}get left(){return this.viewportX}get right(){return this.viewportX+this.viewportWidth}project(t,l){const y=(t-this.xStart)/(this.xEnd-this.xStart),p=(l-this.yStart)/(this.yEnd-this.yStart),h=y*this.viewportWidth+this.viewportX,i=-p*this.viewportHeight+this.viewportY+this.viewportHeight;return[h,i]}unproject(t,l){const y=(t-this.viewportX)/this.viewportWidth,p=-(l-this.viewportY-this.viewportHeight)/this.viewportHeight,h=y*(this.xEnd-this.xStart)+this.xStart,i=p*(this.yEnd-this.yStart)+this.yStart;return[h,i]}}function Q(s,e,t){const{lockX:l=!1,lockY:y=!1,lockScale:p=!1}=t||{},h=(t==null?void 0:t.xStartMin)??-1/0,i=(t==null?void 0:t.xEndMax)??1/0,r=a=>{const c=a.srcEvent;if(c.button!==2)return;c.preventDefault(),s.cursor="grabbing";const{left:d,top:o}=s.canvas.getBoundingClientRect()||{left:0,top:0},u=c.clientX-d,E=c.clientY-o,w=e.xStart,S=e.xEnd,v=b=>{const W=b.srcEvent,Y=W.clientX-d,k=W.clientY-o,I=(e.xEnd-e.xStart)/e.viewportWidth,P=(e.yEnd-e.yStart)/e.viewportHeight;if(!l){const H=w-(Y-u)*I,R=S-(Y-u)*I;H<h?e.xStart=h:R>i?e.xEnd=i:(e.xStart=H,e.xEnd=R)}y||(e.yStart=e.yStart+(k-E)*P,e.yEnd=e.yEnd+(k-E)*P),e.dispatchEvent({type:"update"})},X=b=>{s.cursor="default",s.removeEventListener("pointermove",v),s.removeEventListener("pointerup",X)};s.addEventListener("pointermove",v),s.addEventListener("pointerup",X)},n=a=>{if(p||a.buttons!==0)return;a.preventDefault();const c=Math.pow(1.1,a.deltaY/50),{left:d,top:o}=s.canvas.getBoundingClientRect()||{left:0,top:0},u=a.clientX-d,E=a.clientY-o,[w,S]=e.unproject(u,E);l||(e.xStart=(e.xStart-w)*c+w,e.xEnd=(e.xEnd-w)*c+w,e.xStart=Math.max(e.xStart,(t==null?void 0:t.xStartMin)??-1/0),e.xEnd=Math.min(e.xEnd,(t==null?void 0:t.xEndMax)??1/0)),y||(e.yStart=(e.yStart-S)*c+S,e.yEnd=(e.yEnd-S)*c+S),e.dispatchEvent({type:"update"})},x=a=>{a.preventDefault()};return s.addEventListener("pointerdown",r),s.canvas.addEventListener("wheel",n),s.canvas.addEventListener("contextmenu",x),function(){s.removeEventListener("pointerdown",r),s.canvas.removeEventListener("wheel",n),s.canvas.removeEventListener("contextmenu",x)}}class Z extends m{constructor(e,t){super(),this.coordinator=e,this.config=t;const l=(t==null?void 0:t.followOrigin)??!0,y=(t==null?void 0:t.arrow)??!0,p=((t==null?void 0:t.arrowExtend)??20)*(y?1:0),h=new M;this.add(h),h.style.strokeStyle="red",h.style.lineWidth=2,h.dx=100,h.dy=0;const i=new V;i.points=[{x:10,y:0},{x:0,y:-7},{x:0,y:7}],y&&this.add(i),i.style.fillStyle="red";const r=new M;this.add(r),r.style.strokeStyle="green",r.style.lineWidth=2,r.dx=0,r.dy=-100;const n=new V;n.points=[{x:0,y:-10},{x:7,y:0},{x:-7,y:0}],y&&this.add(n),n.style.fillStyle="green",this.addEventListener("beforeRender",x=>{const a=this.coordinator.viewportX+this.coordinator.viewportWidth,c=this.coordinator.viewportY,d=this.coordinator.viewportX,o=this.coordinator.viewportY+this.coordinator.viewportHeight,u=l?this.coordinator.project(0,0):[d,o];h.x=u[0],h.y=u[1],h.dx=a-h.x+p,i.x=a+p,i.y=u[1],r.x=u[0],r.y=u[1],r.dy=c-r.y-p,n.x=u[0],n.y=c-p})}}function _(s,e){const t=new m,{minDistance:l=100,xToString:y=i=>i.toFixed(2),yToString:p=i=>i.toFixed(2)}=e||{},h=()=>{t.removeAll();const i=new m,r=new m;{const n=s.viewportWidth,x=s.xEnd-s.xStart,a=n/x,c=Math.pow(10,Math.floor(Math.log10(x/10)));let d=c,o=a*d;o<l&&(d=c*2),o=a*d,o<l&&(d=c*5),o=a*d,o<l&&(d=c*10),o=a*d;const u=Math.ceil(s.xStart/d)*d;for(let E=u;E<=s.xEnd;E+=d){const w=new M;w.style.strokeStyle="red",w.style.lineWidth=2,w.dx=0,w.dy=10;const S=s.project(E,0);w.x=S[0],w.y=s.bottom,i.add(w);const v=new C;v.text=y(E),v.style.fillStyle="red",v.style.textAlign="center",v.style.textBaseline="top",v.style.font="12px sans-serif",v.x=S[0],v.y=s.bottom+20,i.add(v)}}{const n=s.viewportHeight,x=s.yEnd-s.yStart,a=n/x,c=Math.pow(10,Math.floor(Math.log10(x/10)));let d=c,o=a*d;o<l&&(d=c*2),o=a*d,o<l&&(d=c*5),o=a*d,o<l&&(d=c*10),o=a*d;const u=Math.ceil(s.yStart/d)*d;for(let E=u;E<=s.yEnd;E+=d){const w=new M;w.style.strokeStyle="green",w.style.lineWidth=2,w.dx=-10,w.dy=0;const S=s.project(0,E);w.x=s.left,w.y=S[1],r.add(w);const v=new C;v.text=p(E),v.style.fillStyle="green",v.style.textAlign="right",v.style.textBaseline="middle",v.style.font="12px sans-serif",v.x=s.left-15,v.y=S[1],r.add(v)}}t.add(i),t.add(r)};return h(),s.addEventListener("update",i=>{h()}),t}export{N as C,D as X,Z as a,J as b,Q as c,K as d,q as l,U as s,_ as t};
